<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crear Orden de Servicio</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/css/login.css">
    <style>
        #drop-zone {
            border: 2px dashed #ccc;
            padding: 20px;
            cursor: pointer;
        }
        #drop-zone.bg-secondary {
            background-color: #6c757d;
        }
        #preview-image {
            max-width: 100%;
            max-height: 200px;
            margin-top: 10px;
        }
        .placa-input {
            font-family: 'Courier New', Courier, monospace;
            font-size: 3rem;
            text-transform: uppercase;
            border: 2px solid #000;
            background-color: #fff;
            color: #000;
            letter-spacing: 0.5rem;
            font-weight: bold;
            width: 100%;
            text-align: center;
            padding: 10px 0;
        }
        .placa-container {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            width: 100%;
        }
    </style>
</head>
<body class="dark-mode">
    <div class="container mt-3">
        <div class="d-flex justify-content-end">
            <a href="{% url 'logout' %}" class="btn btn-danger">Cerrar Sesión</a>
        </div>
    </div>
    <div class="d-flex justify-content-center align-items-center min-vh-100">
        <div class="container mt-5">
            <h2 class="text-center text-white mb-4">Crear Nueva Orden de Servicio</h2>
            <div class="card bg-dark text-white p-4">
                <form method="post" enctype="multipart/form-data">
                    <div class="header">
                        <div class="logo">
                            TU LOGOTIPO<br>EN ESTA PARTE
                        </div>
                        <div class="title">
                            Taller de Motocicletas<br>
                            <span style="font-size: 20px; font-weight: normal;">Orden de Servicio</span>
                        </div>
                        <div class="mecanico">
                            <label>MECÁNICO RESPONSABLE</label>
                            <select class="form-control" name="mechanic" style="width: 180px; border: none; border-bottom: 1px solid #000;" required>
                                <option value="">Seleccione un mecánico</option>
                                {% for mechanic in mechanics %}
                                    <option value="{{ mechanic.id }}">{{ mechanic.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>

                    <div class="main-layout row">
                        <div class="col-md-8">
                            <div class="section-title">DATOS DEL CLIENTE</div>
                            <div class="form-group col-md-12 mb-3">
                                <label for="client">Cliente:</label>
                                <select id="client" name="client" class="form-control rounded">
                                    <option value="">Seleccione un cliente</option>
                                    {% for client in clients %}
                                        <option value="{{ client.id }}">{{ client.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="form-section row">
                                <div class="form-group col-md-12 mb-3">
                                    <label for="nombre">Nombre:</label>
                                    <input type="text" id="nombre" name="nombre" class="form-control rounded" required minlength="3" maxlength="100">
                                </div>
                                <div class="form-group col-md-12 mb-3">
                                    <label for="domicilio">Domicilio:</label>
                                    <input type="text" id="domicilio" name="domicilio" class="form-control rounded" required minlength="5" maxlength="200">
                                </div>
                                <div class="form-group col-md-6 mb-3">
                                    <label for="telefono">Teléfono:</label>
                                    <input type="tel" id="telefono" name="telefono" class="form-control rounded" required pattern="[0-9]{10}" title="Número de teléfono a 10 dígitos">
                                </div>
                                <div class="form-group col-md-6 mb-3">
                                    <label for="whatsapp">Whatsapp:</label>
                                    <input type="tel" id="whatsapp" name="whatsapp" class="form-control rounded" pattern="[0-9]{10}" title="Número de WhatsApp a 10 dígitos">
                                </div>
                                <div class="form-group col-md-12 mb-3">
                                    <label for="correo">Correo:</label>
                                    <input type="email" id="correo" name="correo" class="form-control rounded" required>
                                </div>
                                <div class="form-group col-md-12 mb-3 d-flex align-items-center justify-content-center">
                                    <label class="mr-3">¿Quiere recibir promociones?</label>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="promociones" id="promo_si" value="si" required>
                                        <label class="form-check-label" for="promo_si">Sí</label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="promociones" id="promo_no" value="no" required>
                                        <label class="form-check-label" for="promo_no">No</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="info-box mt-4 p-3">
                                <div class="form-group mb-3">
                                    <label for="fecha">Fecha:</label>
                                    <input type="date" id="fecha" name="fecha" class="form-control rounded" required>
                                </div>
                                <div class="form-group mb-3">
                                    <label for="hora">Hora:</label>
                                    <input type="time" id="hora" name="hora" class="form-control rounded" required>
                                </div>
                            </div>
                            <div class="info-box mt-3 p-3">
                                <div class="form-group mb-0">
                                    <label for="orden_no">Orden No.</label>
                                    <input type="text" id="orden_no" name="orden_no" class="form-control rounded text-right" required minlength="1" maxlength="20">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="section-title mt-4">DATOS DEL VEHÍCULO</div>
                    <div class="info-boxes row">
                        <div class="col-md-8">
                            <div class="form-section row">
                                <div class="form-group col-md-6 mb-3">
                                    <label for="marca">Marca:</label>
                                    <input type="text" id="marca" name="marca" class="form-control rounded" required minlength="2" maxlength="50">
                                </div>
                                <div class="form-group col-md-6 mb-3">
                                    <label for="modelo">Modelo:</label>
                                    <input type="text" id="modelo" name="modelo" class="form-control rounded" required minlength="2" maxlength="50">
                                </div>
                                <div class="form-group col-md-6 mb-3">
                                    <label for="color">Color:</label>
                                    <input type="text" id="color" name="color" class="form-control rounded" required minlength="2" maxlength="30">
                                </div>
                                <div class="form-group col-md-6 mb-3">
                                    <label for="no_serie">No. Serie:</label>
                                    <input type="text" id="no_serie" name="no_serie" class="form-control rounded" required minlength="5" maxlength="50">
                                </div>
                                <div class="form-group col-md-6 mb-3">
                                    <label for="no_motor">No. Motor:</label>
                                    <input type="text" id="no_motor" name="no_motor" class="form-control rounded" required minlength="5" maxlength="50">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 d-flex flex-column justify-content-center align-items-center placa-container">
                            <div class="section-title w-100 text-center" style="margin: 0; padding: 5px; font-size: 14px;">PLACAS</div>
                            <input type="text" name="placa" class="form-control rounded text-center w-100 mt-2 placa-input" placeholder="ABC-123" required pattern="[A-Z0-9]{1,3}[ -]?[A-Z0-9]{3,4}">
                        </div>
                    </div>

                    <div class="status-bar row mt-4 p-3 rounded">
                        <div class="status-item col-md-3 text-center mb-3">
                            <label>Fecha y Hora de Llegada</label>
                            <input type="date" name="fecha_llegada" class="form-control rounded mb-1" required>
                            <input type="time" name="hora_llegada" class="form-control rounded" value="12:12" required>
                        </div>
                        <div class="status-item col-md-3 text-center mb-3">
                            <label>Fecha y Hora de Salida</label>
                            <input type="date" name="fecha_salida" class="form-control rounded mb-1" required>
                            <input type="time" name="hora_salida" class="form-control rounded" value="12:12" required>
                        </div>
                        <div class="status-item col-md-3 text-center mb-3">
                            <label>Kilometraje</label>
                            <div class="gauge-placeholder mb-1">[Manómetro]</div>
                            <input type="number" name="kilometraje" class="form-control rounded" placeholder="Escribir km..." required min="0">
                        </div>
                        <div class="status-item col-md-3 text-center mb-3">
                            <label>Gasolina</label>
                            <div class="fuel-placeholder mb-1">[Indicador]</div>
                            <input type="text" name="gasolina" class="form-control rounded" placeholder="Nivel..." required minlength="1" maxlength="20">
                        </div>
                    </div>

                    <div class="section-title mt-4">ESTADO GENERAL DE LA MOTOCICLETA</div>
                    <p class="text-center mb-3">Señale con una (x) los detalles de la moto.</p>

                    <div class="main-layout row">
                        <div class="col-md-6 inventory-section d-flex flex-column">
                            <div class="inventory-list flex-grow-1">
                                <div class="section-title" style="font-size: 14px; margin-top: 0;">INVENTARIO GENERAL</div>
                                <table class="table table-dark table-bordered">
                                    <thead>
                                        <tr>
                                            <th></th>
                                            <th class="text-center">SÍ</th>
                                            <th class="text-center">NO</th>
                                            <th class="text-center">ESPECIFIQUE</th>
                                        </tr>
                                    </thead>
                                    <tbody id="inventory-items-container"></tbody>
                                </table>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="falla-principal p-3 rounded mb-3">
                                <label class="text-center font-weight-bold text-warning mb-2">FALLA PRINCIPAL DETECTADA</label>
                                <textarea class="form-control rounded" name="falla_principal" rows="4" required minlength="10"></textarea>
                            </div>

                            <div class="section-title" style="font-size: 14px;">ESTADO GENERAL</div>

                            <div class="estado-general-grid row">
                                <div class="estado-box col-md-6 mb-3 p-3 rounded">
                                    <h4 class="text-center mb-2">Motor & Transmisión</h4>
                                    <div class="radio-group">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="motor" id="motor_bueno" value="bueno" required>
                                            <label class="form-check-label" for="motor_bueno">Buen estado</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="motor" id="motor_malo" value="malo">
                                            <label class="form-check-label" for="motor_malo">Mal estado</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="motor" id="motor_atencion" value="atencion">
                                            <label class="form-check-label" for="motor_atencion">Reg. Atención</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="estado-box col-md-6 mb-3 p-3 rounded">
                                    <h4 class="text-center mb-2">Sistema Eléctrico</h4>
                                    <div class="radio-group">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="electrico" id="electrico_bueno" value="bueno" required>
                                            <label class="form-check-label" for="electrico_bueno">Buen estado</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="electrico" id="electrico_malo" value="malo">
                                            <label class="form-check-label" for="electrico_malo">Mal estado</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="electrico" id="electrico_atencion" value="atencion">
                                            <label class="form-check-label" for="electrico_atencion">Reg. Atención</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="estado-box col-md-6 mb-3 p-3 rounded">
                                    <h4 class="text-center mb-2">Discos y Balatas</h4>
                                    <div class="radio-group">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="frenos" id="frenos_bueno" value="bueno" required>
                                            <label class="form-check-label" for="frenos_bueno">Buen estado</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="frenos" id="frenos_malo" value="malo">
                                            <label class="form-check-label" for="frenos_malo">Mal estado</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="frenos" id="frenos_atencion" value="atencion">
                                            <label class="form-check-label" for="frenos_atencion">Reg. Atención</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="estado-box col-md-6 mb-3 p-3 rounded">
                                    <h4 class="text-center mb-2">Suspensión</h4>
                                    <div class="radio-group">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="suspension" id="suspension_bueno" value="bueno" required>
                                            <label class="form-check-label" for="suspension_bueno">Buen estado</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="suspension" id="suspension_malo" value="malo">
                                            <label class="form-check-label" for="suspension_malo">Mal estado</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="suspension" id="suspension_atencion" value="atencion">
                                            <label class="form-check-label" for="suspension_atencion">Reg. Atención</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="estado-box col-md-6 mb-3 p-3 rounded">
                                    <h4 class="text-center mb-2">Nivel de Líquidos</h4>
                                    <div class="radio-group">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="liquidos" id="liquidos_bueno" value="bueno" required>
                                            <label class="form-check-label" for="liquidos_bueno">Buen estado</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="liquidos" id="liquidos_malo" value="malo">
                                            <label class="form-check-label" for="liquidos_malo">Mal estado</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="liquidos" id="liquidos_atencion" value="atencion">
                                            <label class="form-check-label" for="liquidos_atencion">Reg. Atención</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="estado-box col-md-6 mb-3 p-3 rounded">
                                    <h4 class="text-center mb-2">Llantas y Rodamiento</h4>
                                    <div class="radio-group">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="llantas" id="llantas_bueno" value="bueno" required>
                                            <label class="form-check-label" for="llantas_bueno">Buen estado</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="llantas" id="llantas_malo" value="malo">
                                            <label class="form-check-label" for="llantas_malo">Mal estado</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="llantas" id="llantas_atencion" value="atencion">
                                            <label class="form-check-label" for="llantas_atencion">Reg. Atención</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="estado-box col-md-6 mb-3 p-3 rounded">
                                    <h4 class="text-center mb-2">Afinación</h4>
                                    <div class="radio-group">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="afinacion" id="afinacion_bueno" value="bueno" required>
                                            <label class="form-check-label" for="afinacion_bueno">Buen estado</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="afinacion" id="afinacion_malo" value="malo">
                                            <label class="form-check-label" for="afinacion_malo">Mal estado</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="afinacion" id="afinacion_atencion" value="atencion">
                                            <label class="form-check-label" for="afinacion_atencion">Reg. Atención</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="estado-box col-md-6 mb-3 p-3 rounded">
                                    <h4 class="text-center mb-2">Otros</h4>
                                    <textarea class="form-control rounded" name="otros" rows="2"></textarea>
                                </div>
                            </div>
                             <div id="drop-zone" class="moto-placeholder mt-3 p-3 rounded text-center">
                                Arrastra y suelta una imagen aquí o haz clic para seleccionarla
                                <input type="file" id="file-input" accept="image/*" style="display: none;">
                                <img id="preview-image" src="" alt="Vista previa de la imagen" style="max-width: 100%; max-height: 200px; margin-top: 10px; display: none;">
                            </div>
                        </div>
                    </div>

                    <div class="footer-section row mt-4 p-3 rounded">
                        <div class="garantia col-md-8">
                            <div class="section-title">GARANTÍA DEL SERVICIO</div>
                            <div class="form-group d-flex align-items-center mb-3">
                                <label class="mr-3">INCLUIDA</label>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="garantia" id="g_si" value="si" required>
                                    <label class="form-check-label" for="g_si">Sí</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="garantia" id="g_no" value="no" required>
                                    <label class="form-check-label" for="g_no">No</label>
                                </div>
                            </div>
                            <div class="date-range d-flex align-items-center mb-3">
                                <label class="mr-2">Válida desde:</label>
                                <input type="date" name="valida_desde" class="form-control rounded mr-3" required>
                                <label class="mr-2">Válida hasta:</label>
                                <input type="date" name="valida_hasta" class="form-control rounded" required>
                            </div>
                            <div class="form-group mt-3">
                                <label>A excepción de:</label>
                                <input type="text" name="excepcion" class="form-control rounded" maxlength="200">
                            </div>
                        </div>

                        <div class="presupuesto col-md-4">
                            <div class="section-title">PRESUPUESTO GRAL.</div>
                            <div class="form-group mb-3 p-2 rounded" style="background-color: #121212; border: 1px solid #1976D2;">
                                <label for="anticipo">ANTICIPO</label>
                                <div class="input-group">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text">$</span>
                                    </div>
                                    <input type="number" id="anticipo" name="anticipo" class="form-control rounded text-right" required min="0" step="0.01">
                                </div>
                            </div>
                            <div class="form-group restan mb-0 p-2 rounded" style="background-color: #121212; border: 1px solid #FF6F00;">
                                <label for="restan">RESTAN</label>
                                <div class="input-group">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text">$</span>
                                    </div>
                                    <input type="number" id="restan" name="restan" class="form-control rounded text-right" required min="0" step="0.01">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="firma text-center mt-4">
                        FIRMA DE ACEPTACIÓN<br>DEL CLIENTE
                        <div class="signature-box mt-3 mx-auto" style="width: 300px; height: 100px; border: 2px dashed #E0E0E0; border-radius: .5rem;"></div>
                    </div>

                    <button type="submit" class="btn btn-primary mt-4">Guardar Orden</button>
                    <a href="{% url 'search' %}" class="btn btn-secondary mt-4 ml-2">Cancelar</a>
                </form>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const items = ["Tablero completo", "Direccionales", "Claxon", "Botones", "Espejos Retrovisores", "Calavera stop", "Porta placa", "Cuartos", "Manijas de freno", "Manijas de clutch", "Puños", "Escape", "Posapies delanteros", "Posapies traseros", "Chicote Clutch", "Rin Delantero", "Rin Trasero", "Faro", "Cable de bujía", "Kit H(S)", "Accesorios", "Otros"];
            const container = document.getElementById('inventory-items-container');

            items.forEach((item, index) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${item}</td>
                    <td class="text-center"><input type="radio" name="item_${index}" value="si" class="form-check-input"></td>
                    <td class="text-center"><input type="radio" name="item_${index}" value="no" class="form-check-input"></td>
                    <td><input type="text" placeholder="..." class="form-control form-control-sm rounded"></td>
                `;
                container.appendChild(tr);
            });

            const dropZone = document.getElementById('drop-zone');
            const fileInput = document.getElementById('file-input');
            const previewImage = document.getElementById('preview-image');

            dropZone.addEventListener('click', () => fileInput.click());

            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('bg-secondary');
            });

            dropZone.addEventListener('dragleave', (e) => {
                e.preventDefault();
                dropZone.classList.remove('bg-secondary');
            });

            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('bg-secondary');
                const file = e.dataTransfer.files[0];
                handleFile(file);
            });

            fileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                handleFile(file);
            });

            function handleFile(file) {
                if (file && file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        previewImage.src = e.target.result;
                        previewImage.style.display = 'block';
                        dropZone.childNodes[0].nodeValue = '';
                    }
                    reader.readAsDataURL(file);
                }
            }
        });
    </script>
</body>
</html>